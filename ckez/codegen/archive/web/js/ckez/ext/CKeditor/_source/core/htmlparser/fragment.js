CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false}};(function(){var b=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl);var c={ol:1,ul:1};var a=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1});CKEDITOR.htmlParser.fragment.fromHtml=function(i,o,j){var d=new CKEDITOR.htmlParser(),l=j||new CKEDITOR.htmlParser.fragment(),m=[],n=[],e=l,k=false;function g(v){var r;if(m.length>0){for(var s=0;s<m.length;s++){var q=m[s],t=q.name,u=CKEDITOR.dtd[t],p=e.name&&CKEDITOR.dtd[e.name];if((!p||p[t])&&(!v||!u||u[v]||!CKEDITOR.dtd[v])){if(!r){h();r=1}q=q.clone();q.parent=e;e=q;m.splice(s,1);s--}}}}function h(){while(n.length){e.add(n.shift())}}function f(t,u,r){if(t.previous!==undefined){return}u=u||e||l;var w=e;if(o&&(!u.type||u.name=="body")){var x,s;if(t.attributes&&(s=t.attributes["data-cke-real-element-type"])){x=s}else{x=t.name}if(x&&!(x in CKEDITOR.dtd.$body||x=="body"||t.isOrphan)){e=u;d.onTagOpen(o,{});t.returnPoint=u=e}}if(t._.isBlockLike&&t.name!="pre"){var q=t.children.length,p=t.children[q-1],v;if(p&&p.type==CKEDITOR.NODE_TEXT){if(!(v=CKEDITOR.tools.rtrim(p.value))){t.children.length=q-1}else{p.value=v}}}u.add(t);if(t.returnPoint){e=t.returnPoint;delete t.returnPoint}else{e=r?u:w}}d.onTagOpen=function(r,s,u,v){var t=new CKEDITOR.htmlParser.element(r,s);if(t.isUnknown&&u){t.isEmpty=true}t.isOptionalClose=v;if(CKEDITOR.dtd.$removeEmpty[r]){m.push(t);return}else{if(r=="pre"){k=true}else{if(r=="br"&&k){e.add(new CKEDITOR.htmlParser.text("\n"));return}}}if(r=="br"){n.push(t);return}while(1){var x=e.name;var w=x?(CKEDITOR.dtd[x]||(e._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span)):a;if(!t.isUnknown&&!e.isUnknown&&!w[r]){if(e.isOptionalClose){d.onTagClose(x)}else{if(r in c&&x in c){var q=e.children,p=q[q.length-1];if(!(p&&p.name=="li")){f((p=new CKEDITOR.htmlParser.element("li")),e)}!t.returnPoint&&(t.returnPoint=e);e=p}else{if(r in CKEDITOR.dtd.$listItem&&x!=r){d.onTagOpen(r=="li"?"ul":"dl",{},0,1)}else{if(x in b&&x!=r){!t.returnPoint&&(t.returnPoint=e);e=e.parent}else{if(x in CKEDITOR.dtd.$inline){m.unshift(e)}if(e.parent){f(e,e.parent,1)}else{t.isOrphan=1;break}}}}}}else{break}}g(r);h();t.parent=e;if(t.isEmpty){f(t)}else{e=t}};d.onTagClose=function(r){for(var q=m.length-1;q>=0;q--){if(r==m[q].name){m.splice(q,1);return}}var u=[],p=[],s=e;while(s!=l&&s.name!=r){if(!s._.isBlockLike){p.unshift(s)}u.push(s);s=s.returnPoint||s.parent}if(s!=l){for(q=0;q<u.length;q++){var t=u[q];f(t,t.parent)}e=s;if(e.name=="pre"){k=false}if(s._.isBlockLike){h()}f(s,s.parent);if(s==e){e=e.parent}m=m.concat(p)}if(r=="body"){o=false}};d.onText=function(p){if((!e._.hasInlineStarted||n.length)&&!k){p=CKEDITOR.tools.ltrim(p);if(p.length===0){return}}h();g();if(o&&(!e.type||e.name=="body")&&CKEDITOR.tools.trim(p)){this.onTagOpen(o,{},0,1)}if(!k){p=p.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")}e.add(new CKEDITOR.htmlParser.text(p))};d.onCDATA=function(p){e.add(new CKEDITOR.htmlParser.cdata(p))};d.onComment=function(p){h();g();e.add(new CKEDITOR.htmlParser.comment(p))};d.parse(i);h(!CKEDITOR.env.ie&&1);while(e!=l){f(e,e.parent,1)}return l};CKEDITOR.htmlParser.fragment.prototype={add:function(f){var d=this.children.length,e=d>0&&this.children[d-1]||null;if(e){if(f._.isBlockLike&&e.type==CKEDITOR.NODE_TEXT){e.value=CKEDITOR.tools.rtrim(e.value);if(e.value.length===0){this.children.pop();this.add(f);return}}e.next=f}f.previous=e;f.parent=this;this.children.push(f);this._.hasInlineStarted=f.type==CKEDITOR.NODE_TEXT||(f.type==CKEDITOR.NODE_ELEMENT&&!f._.isBlockLike)},writeHtml:function(f,d){var e;this.filterChildren=function(){var h=new CKEDITOR.htmlParser.basicWriter();this.writeChildrenHtml.call(this,h,d,true);var g=h.getHtml();this.children=new CKEDITOR.htmlParser.fragment.fromHtml(g).children;e=1};!this.name&&d&&d.onFragment(this);this.writeChildrenHtml(f,e?null:d)},writeChildrenHtml:function(f,e){for(var d=0;d<this.children.length;d++){this.children[d].writeHtml(f,e)}}}})();