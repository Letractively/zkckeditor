(function(){var p={ol:1,ul:1},c=/^[\n\r\t ]*$/;var k=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(),e=function(i){return !(k(i)||d(i))};CKEDITOR.plugins.list={listToArray:function(w,E,C,B,D){if(!p[w.getName()]){return[]}if(!B){B=0}if(!C){C=[]}for(var y=0,z=w.getChildCount();y<z;y++){var t=w.getChild(y);if(t.type==CKEDITOR.NODE_ELEMENT&&t.getName() in CKEDITOR.dtd.$list){CKEDITOR.plugins.list.listToArray(t,E,C,B+1)}if(t.$.nodeName.toLowerCase()!="li"){continue}var A={parent:w,indent:B,element:t,contents:[]};if(!D){A.grandparent=w.getParent();if(A.grandparent&&A.grandparent.$.nodeName.toLowerCase()=="li"){A.grandparent=A.grandparent.getParent()}}else{A.grandparent=D}if(E){CKEDITOR.dom.element.setMarker(E,t,"listarray_index",C.length)}C.push(A);for(var x=0,u=t.getChildCount(),v;x<u;x++){v=t.getChild(x);if(v.type==CKEDITOR.NODE_ELEMENT&&p[v.getName()]){CKEDITOR.plugins.list.listToArray(v,E,C,B+1,A.grandparent)}else{A.contents.push(v)}}}return C},arrayToList:function(y,D,E,P,H){if(!E){E=0}if(!y||y.length<E+1){return null}var O=y[E].parent.getDocument(),G=new CKEDITOR.dom.documentFragment(O),N=null,v=E,I=Math.max(y[E].indent,0),t=null,C,B=(P==CKEDITOR.ENTER_P?"p":"div");while(1){var L=y[v];if(L.indent==I){if(!N||y[v].parent.getName()!=N.getName()){N=y[v].parent.clone(false,1);H&&N.setAttribute("dir",H);G.append(N)}t=N.append(L.element.clone(0,1));for(var K=0;K<L.contents.length;K++){t.append(L.contents[K].clone(1,1))}v++}else{if(L.indent==Math.max(I,0)+1){var x=L.element.getDirection(1),J=y[v-1].element.getDirection(1),F=CKEDITOR.plugins.list.arrayToList(y,null,v,P,J!=x?x:null);if(!t.getChildCount()&&CKEDITOR.env.ie&&!(O.$.documentMode>7)){t.append(O.createText("\xa0"))}t.append(F.listNode);v=F.nextIndex}else{if(L.indent==-1&&!E&&L.grandparent){if(p[L.grandparent.getName()]){t=L.element.clone(false,true);C=L.element.getDirection(1);L.grandparent.getDirection(1)!=C&&t.setAttribute("dir",C)}else{if(H||L.element.hasAttributes()||P!=CKEDITOR.ENTER_BR){t=O.createElement(B);L.element.copyAttributes(t,{type:1,value:1});C=L.element.getDirection()||H;C&&t.setAttribute("dir",C);if(!H&&P==CKEDITOR.ENTER_BR&&!t.hasAttributes()){t=new CKEDITOR.dom.documentFragment(O)}}else{t=new CKEDITOR.dom.documentFragment(O)}}for(K=0;K<L.contents.length;K++){t.append(L.contents[K].clone(1,1))}if(t.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&v!=y.length-1){var A=t.getLast();if(A&&A.type==CKEDITOR.NODE_ELEMENT&&A.getAttribute("type")=="_moz"){A.remove()}if(!(A=t.getLast(e)&&A.type==CKEDITOR.NODE_ELEMENT&&A.getName() in CKEDITOR.dtd.$block)){t.append(O.createElement("br"))}}if(t.type==CKEDITOR.NODE_ELEMENT&&t.getName()==B&&t.$.firstChild){t.trim();var u=t.getFirst();if(u.type==CKEDITOR.NODE_ELEMENT&&u.isBlockBoundary()){var M=new CKEDITOR.dom.documentFragment(O);t.moveChildren(M);t=M}}var z=t.$.nodeName.toLowerCase();if(!CKEDITOR.env.ie&&(z=="div"||z=="p")){t.appendBogus()}G.append(t);N=null;v++}else{return null}}}if(y.length<=v||Math.max(y[v].indent,0)<I){break}}if(D){var w=G.getFirst();while(w){if(w.type==CKEDITOR.NODE_ELEMENT){CKEDITOR.dom.element.clearMarkers(D,w)}w=w.getNextSourceNode()}}return{listNode:G,nextIndex:v}}};function h(t){if(t.editor.readOnly){return null}var y=t.data.path,u=y.blockLimit,x=y.elements,w,v;for(v=0;v<x.length&&(w=x[v])&&!w.equals(u);v++){if(p[x[v].getName()]){return this.setState(this.type==x[v].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}}return this.setState(CKEDITOR.TRISTATE_OFF)}function g(C,B,F,G){var y=CKEDITOR.plugins.list.listToArray(B.root,F),E=[];for(var A=0;A<B.contents.length;A++){var w=B.contents[A];w=w.getAscendant("li",true);if(!w||w.getCustomData("list_item_processed")){continue}E.push(w);CKEDITOR.dom.element.setMarker(F,w,"list_item_processed",true)}var D=B.root,z=D.getDocument().createElement(this.type);D.copyAttributes(z,{start:1,type:1});z.removeStyle("list-style-type");for(A=0;A<E.length;A++){var x=E[A].getCustomData("listarray_index");y[x].parent=z}var v=CKEDITOR.plugins.list.arrayToList(y,F,null,C.config.enterMode);var u,t=v.listNode.getChildCount();for(A=0;A<t&&(u=v.listNode.getChild(A));A++){if(u.getName()==this.type){G.push(u)}}v.listNode.replace(B.root)}var s=/^h[1-6]$/;function b(u,z,y){var H=z.contents,L=z.root.getDocument(),J=[];if(H.length==1&&H[0].equals(z.root)){var G=L.createElement("div");H[0].moveChildren&&H[0].moveChildren(G);H[0].append(G);H[0]=G}var D=z.contents[0].getParent();for(var F=0;F<H.length;F++){D=D.getCommonAncestor(H[F].getParent())}var I=u.config.useComputedState,E,t;I=I===undefined||I;for(F=0;F<H.length;F++){var w=H[F],A;while((A=w.getParent())){if(A.equals(D)){J.push(w);if(!t&&w.getDirection()){t=1}var C=w.getDirection(I);if(E!==null){if(E&&E!=C){E=null}else{E=C}}break}w=A}}if(J.length<1){return}var K=J[J.length-1].getNext(),v=L.createElement(this.type);y.push(v);var x,B;while(J.length){x=J.shift();B=L.createElement("li");if(x.is("pre")||s.test(x.getName())){x.appendTo(B)}else{if(E&&x.getDirection()){x.removeStyle("direction");x.removeAttribute("dir")}x.copyAttributes(B);x.moveChildren(B);x.remove()}B.appendTo(v)}if(E&&t){v.setAttribute("dir",E)}if(K){v.insertBefore(K)}else{v.appendTo(D)}}function r(C,B,I){var y=CKEDITOR.plugins.list.listToArray(B.root,I),G=[];for(var z=0;z<B.contents.length;z++){var v=B.contents[z];v=v.getAscendant("li",true);if(!v||v.getCustomData("list_item_processed")){continue}G.push(v);CKEDITOR.dom.element.setMarker(I,v,"list_item_processed",true)}var D=null;for(z=0;z<G.length;z++){var x=G[z].getCustomData("listarray_index");y[x].indent=-1;D=x}for(z=D+1;z<y.length;z++){if(y[z].indent>y[z-1].indent+1){var F=y[z-1].indent+1-y[z].indent;var w=y[z].indent;while(y[z]&&y[z].indent>=w){y[z].indent+=F;z++}z--}}var u=CKEDITOR.plugins.list.arrayToList(y,I,null,C.config.enterMode,B.root.getAttribute("dir"));var E=u.listNode,t,A;function H(i){if((t=E[i?"getFirst":"getLast"]())&&!(t.is&&t.isBlockBoundary())&&(A=B.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(true)))&&!(A.is&&A.isBlockBoundary({br:1}))){C.document.createElement("br")[i?"insertBefore":"insertAfter"](t)}}H(true);H();E.replace(B.root)}function m(i,t){this.name=i;this.type=t}m.prototype={exec:function(v){var X=v.document,U=v.config,W=v.getSelection(),u=W&&W.getRanges(true);if(!u||u.length<1){return}if(this.state==CKEDITOR.TRISTATE_OFF){var F=X.getBody();if(!F.getFirst(e)){U.enterMode==CKEDITOR.ENTER_BR?F.appendBogus():u[0].fixBlock(1,U.enterMode==CKEDITOR.ENTER_P?"p":"div");W.selectRanges(u)}else{var H=u.length==1&&u[0],R=H&&H.getEnclosedNode();if(R&&R.is&&this.type==R.getName()){this.setState(CKEDITOR.TRISTATE_ON)}}}var x=W.createBookmarks(true);var S=[],G={},E=u.createIterator(),z=0;while((H=E.getNextRange())&&++z){var Q=H.getBoundaryNodes(),V=Q.startNode,I=Q.endNode;if(V.type==CKEDITOR.NODE_ELEMENT&&V.getName()=="td"){H.setStartAt(Q.startNode,CKEDITOR.POSITION_AFTER_START)}if(I.type==CKEDITOR.NODE_ELEMENT&&I.getName()=="td"){H.setEndAt(Q.endNode,CKEDITOR.POSITION_BEFORE_END)}var K=H.createIterator(),D;K.forceBrBreak=(this.state==CKEDITOR.TRISTATE_OFF);while((D=K.getNextParagraph())){if(D.getCustomData("list_block")){continue}else{CKEDITOR.dom.element.setMarker(G,D,"list_block",1)}var J=new CKEDITOR.dom.elementPath(D),T=J.elements,P=T.length,w=null,C=0,y=J.blockLimit,t;for(var O=P-1;O>=0&&(t=T[O]);O--){if(p[t.getName()]&&y.contains(t)){y.removeCustomData("list_group_object_"+z);var B=t.getCustomData("list_group_object");if(B){B.contents.push(D)}else{B={root:t,contents:[D]};S.push(B);CKEDITOR.dom.element.setMarker(G,t,"list_group_object",B)}C=1;break}}if(C){continue}var N=y;if(N.getCustomData("list_group_object_"+z)){N.getCustomData("list_group_object_"+z).contents.push(D)}else{B={root:N,contents:[D]};CKEDITOR.dom.element.setMarker(G,N,"list_group_object_"+z,B);S.push(B)}}}var A=[];while(S.length>0){B=S.shift();if(this.state==CKEDITOR.TRISTATE_OFF){if(p[B.root.getName()]){g.call(this,v,B,G,A)}else{b.call(this,v,B,A)}}else{if(this.state==CKEDITOR.TRISTATE_ON&&p[B.root.getName()]){r.call(this,v,B,G)}}}for(O=0;O<A.length;O++){w=A[O];var L,M=this;(L=function(Y){var i=w[Y?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(true));if(i&&i.getName&&i.getName()==M.type){i.remove();i.moveChildren(w,Y)}})();L(1)}CKEDITOR.dom.element.clearAllMarkers(G);W.selectBookmarks(x);v.focus()}};var l=CKEDITOR.dtd;var q=/[\t\r\n ]*(?:&nbsp;|\xa0)$/;function j(v,y){var x,u=v.children,w=u.length;for(var t=0;t<w;t++){x=u[t];if(x.name&&(x.name in y)){return t}}return w}function a(i){return function(y){var v=y.children,x=j(y,l.$list),u=v[x],t=u&&u.previous,z;if(t&&(t.name&&t.name=="br"||t.value&&(z=t.value.match(q)))){var w=t;if(!(z&&z.index)&&w==v[0]){v[0]=(i||CKEDITOR.env.ie)?new CKEDITOR.htmlParser.text("\xa0"):new CKEDITOR.htmlParser.element("br",{})}else{if(w.name=="br"){v.splice(x-1,1)}else{w.value=w.value.replace(q,"")}}}}}var f={elements:{}};for(var n in l.$listItem){f.elements[n]=a()}var o={elements:{}};for(n in l.$listItem){o.elements[n]=a(true)}CKEDITOR.plugins.add("list",{init:function(t){var u=t.addCommand("numberedlist",new m("numberedlist","ol")),i=t.addCommand("bulletedlist",new m("bulletedlist","ul"));t.ui.addButton("NumberedList",{label:t.lang.numberedlist,command:"numberedlist"});t.ui.addButton("BulletedList",{label:t.lang.bulletedlist,command:"bulletedlist"});t.on("selectionChange",CKEDITOR.tools.bind(h,u));t.on("selectionChange",CKEDITOR.tools.bind(h,i))},afterInit:function(t){var i=t.dataProcessor;if(i){i.dataFilter.addRules(f);i.htmlFilter.addRules(o)}},requires:["domiterator"]})})();