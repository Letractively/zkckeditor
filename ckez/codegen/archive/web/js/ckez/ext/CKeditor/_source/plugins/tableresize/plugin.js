(function(){var a=CKEDITOR.tools.cssLength,d=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);function f(k){return CKEDITOR.env.ie?k.$.clientWidth:parseInt(k.getComputedStyle("width"),10)}function b(l,k){var m=l.getComputedStyle("border-"+k+"-width"),n={thin:"0px",medium:"1px",thick:"2px"};if(m.indexOf("px")<0){if(m in n&&l.getComputedStyle("border-style")!="none"){m=n[m]}else{m=0}}return parseInt(m,10)}function i(q){var m=q.$.rows,o=0,r,l,p;for(var n=0,k=m.length;n<k;n++){p=m[n];r=p.cells.length;if(r>o){o=r;l=p}}return l}function h(A){var z=[],l=-1,v=(A.getComputedStyle("direction")=="rtl");var r=i(A);var p=new CKEDITOR.dom.element(A.$.tBodies[0]),t=p.getDocumentPosition();for(var o=0,s=r.cells.length;o<s;o++){var n=new CKEDITOR.dom.element(r.cells[o]),m=r.cells[o+1]&&new CKEDITOR.dom.element(r.cells[o+1]);l+=n.$.colSpan||1;var k,q,y,u;var w=n.getDocumentPosition().x;v?q=w+b(n,"left"):k=w+n.$.offsetWidth-b(n,"right");if(m){w=m.getDocumentPosition().x;v?k=w+m.$.offsetWidth-b(m,"right"):q=w+b(m,"left")}else{w=A.getDocumentPosition().x;v?k=w:q=w+A.$.offsetWidth}y=Math.max(q-k,3);u=Math.max(Math.round(7-(y/2)),0);z.push({table:A,index:l,x:k,y:t.y,width:y,height:p.$.offsetHeight,padding:u,rtl:v})}return z}function c(p,m){for(var l=0,k=p.length;l<k;l++){var o=p[l],n=o.padding;if(m>=o.x-n&&m<=(o.x+o.width+n)){return o}}return null}function j(k){(k.data||k).preventDefault()}function e(l){var B,v,q,u,y,s;var z,m,n,w;function C(){B=null;s=0;u=0;v.removeListener("mouseup",k);q.removeListener("mousedown",o);q.removeListener("mousemove",p);v.getBody().setStyle("cursor","auto");d?q.remove():q.hide()}function A(){var I=B.index,D=CKEDITOR.tools.buildTableMap(B.table),J=[],K=[],E=Number.MAX_VALUE,L=E,N=B.rtl;for(var G=0,H=D.length;G<H;G++){var O=D[G],M=O[I+(N?1:0)],F=O[I+(N?0:1)];M=M&&new CKEDITOR.dom.element(M);F=F&&new CKEDITOR.dom.element(F);if(!M||!F||!M.equals(F)){M&&(E=Math.min(E,f(M)));F&&(L=Math.min(L,f(F)));J.push(M);K.push(F)}}z=J;m=K;n=B.x-E;w=B.x+L;q.setOpacity(0.5);y=parseInt(q.getStyle("left"),10);s=0;u=1;q.on("mousemove",p);v.on("dragstart",j)}function t(){u=0;q.setOpacity(0);s&&r();var D=B.table;setTimeout(function(){D.removeCustomData("_cke_table_pillars")},0);v.removeListener("dragstart",j)}function r(){var H=B.rtl,I=H?m.length:z.length;for(var E=0;E<I;E++){var D=z[E],G=m[E],F=B.table;CKEDITOR.tools.setTimeout(function(K,N,M,O,J,L){K&&K.setStyle("width",a(Math.max(N+L,0)));M&&M.setStyle("width",a(Math.max(O-L,0)));if(J){F.setStyle("width",a(J+L*(H?-1:1)))}},0,this,[D,D&&f(D),G,G&&f(G),(!D||!G)&&(f(F)+b(F,"left")+b(F,"right")),s])}}function o(D){j(D);A();v.on("mouseup",k,this)}function k(D){D.removeListener();t()}function p(D){x(D.data.$.clientX)}v=l.document;q=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',v);if(!d){v.getDocumentElement().append(q)}this.attachTo=function(D){if(u){return}if(d){v.getBody().append(q);s=0}B=D;q.setStyles({width:a(D.width),height:a(D.height),left:a(D.x),top:a(D.y)});d&&q.setOpacity(0.25);q.on("mousedown",o,this);v.getBody().setStyle("cursor","col-resize");q.show()};var x=this.move=function(F){if(!B){return 0}var E=B.padding;if(!u&&(F<B.x-E||F>(B.x+B.width+E))){C();return 0}var D=F-Math.round(q.$.offsetWidth/2);if(u){if(D==n||D==w){return 1}D=Math.max(D,n);D=Math.min(D,w);s=D-y}q.setStyle("left",a(D));return 1}}function g(k){var m=k.data.getTarget();if(k.name=="mouseout"){if(!m.is("table")){return}var l=new CKEDITOR.dom.element(k.data.$.relatedTarget||k.data.$.toElement);while(l&&l.$&&!l.equals(m)&&!l.is("body")){l=l.getParent()}if(!l||l.equals(m)){return}}m.getAscendant("table",1).removeCustomData("_cke_table_pillars");k.removeListener()}CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(k){k.on("contentDom",function(){var l;k.document.getBody().on("mousemove",function(m){m=m.data;if(l&&l.move(m.$.clientX)){j(m);return}var q=m.getTarget(),n,p;if(!q.is("table")&&!q.getAscendant("tbody",1)){return}n=q.getAscendant("table",1);if(!(p=n.getCustomData("_cke_table_pillars"))){n.setCustomData("_cke_table_pillars",(p=h(n)));n.on("mouseout",g);n.on("mousedown",g)}var o=c(p,m.$.clientX);if(o){!l&&(l=new e(k));l.attachTo(o)}})})}})})();