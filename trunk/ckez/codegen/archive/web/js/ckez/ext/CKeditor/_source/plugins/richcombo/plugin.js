CKEDITOR.plugins.add("richcombo",{requires:["floatpanel","listblock","button"],beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}});CKEDITOR.UI_RICHCOMBO="richcombo";CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(a){CKEDITOR.tools.extend(this,a,{title:a.label,modes:{wysiwyg:1}});var b=this.panel||{};delete this.panel;this.id=CKEDITOR.tools.getNextNumber();this.document=(b&&b.parent&&b.parent.getDocument())||CKEDITOR.document;b.className=(b.className||"")+" cke_rcombopanel";b.block={multiSelect:b.multiSelect,attributes:b.attributes};this._={panelDefinition:b,items:{},state:CKEDITOR.TRISTATE_OFF}},statics:{handler:{create:function(a){return new CKEDITOR.ui.richCombo(a)}}},proto:{renderHtml:function(b){var a=[];this.render(b,a);return a.join("")},render:function(e,c){var d=CKEDITOR.env;var h="cke_"+this.id;var g=CKEDITOR.tools.addFunction(function(i){var j=this._;if(j.state==CKEDITOR.TRISTATE_DISABLED){return}this.createPanel(e);if(j.on){j.panel.hide();return}this.commit();var k=this.getValue();if(k){j.list.mark(k)}else{j.list.unmarkAll()}j.panel.showBlock(this.id,new CKEDITOR.dom.element(i),4)},this);var a={id:h,combo:this,focus:function(){var i=CKEDITOR.document.getById(h).getChild(1);i.focus()},clickFn:g};function b(){var i=this.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;this.setState(e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:i);this.setValue("")}e.on("mode",b,this);!this.readOnly&&e.on("readOnly",b,this);var f=CKEDITOR.tools.addFunction(function(j,i){j=new CKEDITOR.dom.event(j);var k=j.getKeystroke();switch(k){case 13:case 32:case 40:CKEDITOR.tools.callFunction(g,i);break;default:a.onkey(a,k)}j.preventDefault()});a.keyDownFn=f;c.push('<span class="cke_rcombo" role="presentation">',"<span id=",h);if(this.className){c.push(' class="',this.className,' cke_off"')}c.push(' role="presentation">','<span id="'+h+'_label" class=cke_label>',this.label,"</span>",'<a hidefocus=true title="',this.title,'" tabindex="-1"',d.gecko&&d.version>=10900&&!d.hc?"":" href=\"javascript:void('"+this.label+"')\"",' role="button" aria-labelledby="',h,'_label" aria-describedby="',h,'_text" aria-haspopup="true"');if(CKEDITOR.env.opera||(CKEDITOR.env.gecko&&CKEDITOR.env.mac)){c.push(' onkeypress="return false;"')}if(CKEDITOR.env.gecko){c.push(' onblur="this.style.cssText = this.style.cssText;"')}c.push(' onkeydown="CKEDITOR.tools.callFunction( ',f,', event, this );" onclick="CKEDITOR.tools.callFunction(',g,', this); return false;"><span><span id="'+h+'_text" class="cke_text cke_inline_label">'+this.label+"</span></span><span class=cke_openbutton><span class=cke_icon>"+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span></span>");if(this.onRender){this.onRender()}return a},createPanel:function(b){if(this._.panel){return}var g=this._.panelDefinition,f=this._.panelDefinition.block,e=g.parent||CKEDITOR.document.getBody(),a=new CKEDITOR.ui.floatPanel(b,e,g),d=a.addListBlock(this.id,f),c=this;a.onShow=function(){if(c.className){this.element.getFirst().addClass(c.className+"_panel")}c.setState(CKEDITOR.TRISTATE_ON);d.focus(!c.multiSelect&&c.getValue());c._.on=1;if(c.onOpen){c.onOpen()}};a.onHide=function(h){if(c.className){this.element.getFirst().removeClass(c.className+"_panel")}c.setState(c.modes&&c.modes[b.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);c._.on=0;if(!h&&c.onClose){c.onClose()}};a.onEscape=function(){a.hide();c.document.getById("cke_"+c.id).getFirst().getNext().focus()};d.onClick=function(i,h){c.document.getWindow().focus();if(c.onClick){c.onClick.call(c,i,h)}if(h){c.setValue(i,c._.items[i])}else{c.setValue("")}a.hide()};this._.panel=a;this._.list=d;a.getBlock(this.id).onHide=function(){c._.on=0;c.setState(CKEDITOR.TRISTATE_OFF)};if(this.init){this.init()}},setValue:function(b,c){this._.value=b;var a=this.document.getById("cke_"+this.id+"_text");if(a){if(!(b||c)){c=this.label;a.addClass("cke_inline_label")}else{a.removeClass("cke_inline_label")}a.setHtml(typeof c!="undefined"?c:b)}},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(a){this._.list.mark(a)},hideItem:function(a){this._.list.hideItem(a)},hideGroup:function(a){this._.list.hideGroup(a)},showAll:function(){this._.list.showAll()},add:function(b,a,c){this._.items[b]=c||b;this._.list.add(b,a,c)},startGroup:function(a){this._.list.startGroup(a)},commit:function(){if(!this._.committed){this._.list.commit();this._.committed=1;CKEDITOR.ui.fire("ready",this)}this._.committed=1},setState:function(a){if(this._.state==a){return}this.document.getById("cke_"+this.id).setState(a);this._.state=a}}});CKEDITOR.ui.prototype.addRichCombo=function(a,b){this.add(a,CKEDITOR.UI_RICHCOMBO,b)};